<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title id="page_title">ぷよぷよ</title>
        <link rel="stylesheet" type="text/css" href="../../../../common/format.css">
    </head>
    <body>
        <header>
            <iframe class="header" src="../../../../common/header.html" frameborder="0"></iframe>
        </header>
        <div class="contents">
            <iframe class="menu" src="../../../../common/menu.html" frameborder="0"></iframe>

            <div class="main">
                <h1 id="title"><img class="icon" src="../../../../common/images/game.png" />ぷよぷよ</h1>
                <div class="explanation paper">
                    <h2 class="top">ぷよぷよとは</h2>
                    <p>
                        コンパイルが開発し、1991年に徳間書店インターメディアから発売された落ち物パズルゲームです。画面上部からふたつのぷよが対になったものが落ちてくるので、これを回転、移動させて積み重ね、できるだけ長時間一番上までブロックが積み重ならないようにします。なお、ここではゲームそのものを指す場合に「ぷよぷよ」、落下する球体を指す場合に「ぷよ」と言い分けています。
                    </p>

                    <h2>遊び方</h2>
                    <p>
                        このゲームは他の落ちものゲーム同様、ゲームオーバーになるまでにできるだけハイスコアを獲得できるようにするのが目標です。<br>ぷよが一番上まで積み重なってしまうとゲームオーバーになります。一方、同じ色のぷよが４つ以上隣接（この場合縦か横、つまりフォン・ノイマン近傍で隣接）すると、それらが消えてその上にあるぷよが落ちてきます。要するに、同じ色のぷよが隣接するようにしさえすればいいのです。従ってゲームオーバーにならないようにするだけならさほど難しくはありません。<br>
                        このゲームの醍醐味は、なんといっても「連鎖」です。連鎖とは、一度に複数のぷよの塊が消えることを指します。つまり、ぷよが消滅してその上にあったぷよが落下してきたとき、この落下してきたぷよによって同じ色のぷよが新たに４つ以上隣接し、別のぷよの塊が消滅するということです。連鎖の数が多いほど得点は指数関数的に増加しますし、何より多重連鎖を起こすと例えようのない快感を味わうことができます。<br>
                        ぷよぷよはてとりすに比べて盤面が狭く、また連鎖を考えるというゲームの性質があるため、落下速度をゲームの進行に合わせて加速させてはいません。いつまで経ってもぷよは同じ速度で落ちてくるので、安心して最高の連鎖を組み上げてみてください。
                    </p>

                    <h2>得点計算方法</h2>
                    <p>
                        高速落下： 1pt<br><br>
                        ＜連鎖ポイント＞<br>
                        N連鎖： 3^N（3のN乗）pt<br>
                        従って、0連鎖（＝ぷよが消滅せずに、ただ落下し切っただけ）でも1pt獲得できます。やさしいね！<br>
                        ※連鎖という言葉を使う以上、本来であればNは２以上の数字になるはずですが、便宜上消えるぷよの塊の数を表すのに「連鎖」という言葉を用います。
                    </p>

                    <h2>開発裏話</h2>
                    <p>
                        このプログラムは、てとりすの拡張で作ってます。とは言うものの、最初想定していたよりもかなり改変する必要があって、思っていたよりずっと大変でしたね。<br>
                        例えば、ぷよを消滅させるアルゴリズムです。てとりすの場合ならただ単に横一行揃ったら丸ごと消せば良いだけなのですが、ぷよぷよだと隣接した同じ色を消す必要があります。つまり、隣接した同じ色を探さないといけないんですね。これが意外と難しい。それで、古典的なアルゴリズムである幅優先探索を取り入れてます。要するに、落下してきたぷよを起点として、その周辺に同じ色のぷよがあるかを調べていくわけです。<br>
                        こうしてぷよを消滅させた後も、てとりすほど一筋縄ではいきません。つまり、どうやって浮いているぷよを落下させるかってことです。てとりすなら行ごとに消えてくれるので、消した後はその上にあるセルをごっそり下に移動させればいいですが、ぷよぷよだと消える場所が塊状で規則性を持たないんですね。これについては、消したぷよのX座標を記録しておき、同じX座標を持つぷよに対して下側にある（Y座標の大きい）ぷよから順に落下し切るまで落とす、というプログラムで解決しています。<br>
                        まあ、とは言ってもやはり一番困難を極めたのは、このプログラム自体が元々てとりす用であるが故にてとりすに最適化されている箇所があって、それに対して整合性を持つぷよぷよのプログラムを作らなければならなかったという所ですね。特に配列（ベクトル、行列など）です。何層の配列にするかでプログラムの挙動が変わってしまうので、それによる種々のバグでかなり時間を持っていかれました。
                    </p>
                </div>
            </div>
        </div>
        <footer>
            <iframe class="footer" src="../../../../common/footer.html" frameborder="0"></iframe>
        </footer>
    </body>
</html>
